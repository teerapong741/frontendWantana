<loading *ngIf="loading"></loading>
<div class="container">
  <div>
    <label class="container__label">ข้อมูลพนักงาน</label>
    <button
      *ngIf="authService.isRole() === 'ADMIN'"
      pButton
      pRipple
      label="เพิ่มพนักงานใหม่"
      icon="fas fa-plus"
      class="p-button-raised p-button-success p-button-lg container__btn-add"
      (click)="onVisibleNewEmployee()"
    ></button>
  </div>
  <p-table
    [value]="employeeList"
    [rows]="10"
    [paginator]="true"
    responsiveLayout="scroll"
    styleClass="p-datatable-lg"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>ลำดับที่</th>
        <th>รหัส</th>
        <th>ชื่อ</th>
        <th>นามสกุล</th>
        <th>ที่อยู่</th>
        <th>เบอร์โทร</th>
        <th>อีเมล์</th>
        <th>สิทธิ์ผู้ใช้</th>
        <th>สถานะ</th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-employee let-index="rowIndex">
      <tr
        [ngStyle]="{
          background: employee.key === employeeLogin.key ? '#ffd3d3b2' : null
        }"
      >
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          {{ index + 1 }}
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          {{ employee.key }}
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          {{ employee.firstName }}
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          {{ employee.lastName }}
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          {{ employee.address }}
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          {{ employee.phoneNumber }}
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          {{ employee.email }}
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          <p-chip label="{{ employee.role | translate }}"></p-chip>
        </td>
        <td
          [ngStyle]="{
            'font-weight': employee.key === employeeLogin.key ? '700' : null
          }"
        >
          <p-tag
            styleClass="mr-2 font-bold"
            [style]="{
              'font-size': '14px',
              padding: '.2rem .5rem .2rem .5rem '
            }"
            [severity]="!!employee.deleted_at ? 'warning' : 'success'"
            [value]="!!employee.deleted_at ? 'ลาออกแล้ว' : 'อยู่ในระบบ'"
            [rounded]="true"
          ></p-tag>
        </td>
        <td class="container__action">
          <button
            *ngIf="
              (!employee.deleted_at && authService.isRole() === 'ADMIN') ||
              employee.key == employeeLogin.key
            "
            pButton
            pRipple
            type="button"
            icon="fas fa-edit"
            class="p-button-rounded p-button-raised p-button-warning"
            (click)="onVisibleEditEmployee(employee)"
          ></button>
          <button
            *ngIf="!employee.deleted_at && employee.key === employeeLogin.key"
            pButton
            pRipple
            type="button"
            icon="fas fa-key"
            class="p-button-rounded p-button-raised p-button-help"
            (click)="onVisibleEditPassword(employee)"
          ></button>
          <button
            *ngIf="!employee.deleted_at && authService.isRole() === 'ADMIN'"
            pButton
            pRipple
            type="button"
            icon="fas fa-sync"
            class="p-button-rounded p-button-raised p-button-info"
            (click)="onResetPassword(employee.id, employee.idCard)"
          ></button>
          <button
            *ngIf="
              !employee.deleted_at &&
              authService.isRole() === 'ADMIN' &&
              employee.key !== employeeLogin.key &&
              employee.role !== 'ADMIN'
            "
            pButton
            pRipple
            type="button"
            icon="fas fa-trash"
            class="p-button-rounded p-button-raised p-button-danger"
            (click)="onDelete(employee.id)"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  header="เพิ่มพนักงานใหม่"
  [(visible)]="newEmployeeVisible"
  (onHide)="onResetValue()"
>
  <div class="container-add-texture">
    <div class="field">
      <label for="idCard" class="block">รหัสบัตรประชาชน</label>
      <input
        id="idCard"
        type="text"
        pInputText
        [(ngModel)]="idCard"
        placeholder="โปรดระบุรหัสบัตรประชาชน"
      />
    </div>
    <div class="field">
      <label for="fname" class="block">ชื่อ</label>
      <input
        id="fname"
        type="text"
        pInputText
        [(ngModel)]="fname"
        placeholder="โปรดระบุชื่อ"
      />
    </div>
    <div class="field">
      <label for="lname" class="block">นามสกุล</label>
      <input
        id="lname"
        type="text"
        pInputText
        [(ngModel)]="lname"
        placeholder="โปรดระบุนามสกุล"
      />
    </div>
    <div class="field">
      <label for="phone" class="block">เบอร์มือถือ</label>
      <input
        id="phone"
        type="text"
        pInputText
        [(ngModel)]="phone"
        placeholder="โปรดระบุเบอร์มือถือ"
      />
    </div>
    <div class="field">
      <label for="address" class="block">ที่อยู่</label>
      <input
        id="address"
        type="text"
        pInputText
        [(ngModel)]="address"
        placeholder="โปรดระบุที่อยู่"
      />
    </div>
    <div class="field">
      <label for="email" class="block">อีเมล์</label>
      <input
        id="email"
        type="text"
        pInputText
        [(ngModel)]="email"
        placeholder="โปรดระบุอีเมล์"
      />
    </div>
    <div class="field">
      <label for="role" class="block">สิทธิ์ผู้ใช้</label>
      <p-dropdown
        [options]="roleOptions"
        [(ngModel)]="role"
        placeholder="เลือกสิทธิ์ผู้ใช้"
        optionLabel="name"
        optionValue="value"
        [showClear]="false"
        [style]="{ width: '30rem' }"
      ></p-dropdown>
    </div>
    <button
      pButton
      pRipple
      class="p-button-success p-button-raised"
      label="เพิ่ม"
      icon="fas fa-plus"
      style="width: 100%; margin-top: 1rem"
      (click)="onNewEmployee()"
    ></button>
  </div>
</p-dialog>

<p-dialog
  header="แก้ไขข้อมูลพนักงาน"
  [(visible)]="editEmployeeVisible"
  (onHide)="onResetValue()"
>
  <div class="container-add-texture">
    <div class="field">
      <label for="idCard" class="block">รหัสบัตรประชาชน</label>
      <input
        id="idCard"
        type="text"
        pInputText
        [(ngModel)]="idCard"
        placeholder="โปรดระบุรหัสบัตรประชาชน"
      />
    </div>
    <div class="field">
      <label for="fname" class="block">ชื่อ</label>
      <input
        id="fname"
        type="text"
        pInputText
        [(ngModel)]="fname"
        placeholder="โปรดระบุชื่อ"
      />
    </div>
    <div class="field">
      <label for="lname" class="block">นามสกุล</label>
      <input
        id="lname"
        type="text"
        pInputText
        [(ngModel)]="lname"
        placeholder="โปรดระบุนามสกุล"
      />
    </div>
    <div class="field">
      <label for="phone" class="block">เบอร์มือถือ</label>
      <input
        id="phone"
        type="text"
        pInputText
        [(ngModel)]="phone"
        placeholder="โปรดระบุเบอร์มือถือ"
      />
    </div>
    <div class="field">
      <label for="address" class="block">ที่อยู่</label>
      <input
        id="address"
        type="text"
        pInputText
        [(ngModel)]="address"
        placeholder="โปรดระบุที่อยู่"
      />
    </div>
    <div class="field">
      <label for="email" class="block">อีเมล์</label>
      <input
        id="email"
        type="text"
        pInputText
        [(ngModel)]="email"
        placeholder="โปรดระบุอีเมล์"
      />
    </div>
    <div class="field">
      <label for="role" class="block">สิทธิ์ผู้ใช้</label>
      <p-dropdown
        [options]="roleOptions"
        [(ngModel)]="role"
        placeholder="เลือกสิทธิ์ผู้ใช้"
        optionLabel="name"
        optionValue="value"
        [showClear]="false"
        [style]="{ width: '30rem' }"
      ></p-dropdown>
    </div>
    <button
      pButton
      pRipple
      class="p-button-success p-button-raised"
      label="แก้ไข"
      icon="fas fa-plus"
      style="width: 100%; margin-top: 1rem"
      (click)="onEditEmployee()"
    ></button>
  </div>
</p-dialog>

<p-dialog
  header="แก้ไขรหัสผ่าน"
  [(visible)]="editPasswordVisible"
  (onHide)="onResetValue()"
>
  <div class="container-add-texture">
    <p-password
      [(ngModel)]="fakeInput"
      [style]="{ display: 'none' }"
    ></p-password>
    <div class="field">
      <label class="block">รหัสผ่านเดิม</label>
      <p-password
        [toggleMask]="true"
        [(ngModel)]="editOldPassword"
        placeholder="รหัสผ่านเดิม"
        [style]="{ width: '100%' }"
        [feedback]="false"
      ></p-password>
    </div>
    <div class="field">
      <label class="block">รหัสผ่านใหม่</label>
      <p-password
        [toggleMask]="true"
        [(ngModel)]="editPassword"
        [style]="{ width: '100%' }"
        placeholder="รหัสผ่านใหม่"
      ></p-password>
    </div>
    <div class="field">
      <label class="block">ยืนยันรหัสผ่านใหม่</label>
      <p-password
        [toggleMask]="true"
        [(ngModel)]="confirmPassword"
        [style]="{ width: '100%' }"
        placeholder="ยืนยันรหัสผ่านใหม่"
        [feedback]="false"
      ></p-password>
    </div>
    <button
      pButton
      pRipple
      class="p-button-success p-button-raised"
      label="แก้ไข"
      icon="fas fa-plus"
      style="width: 100%; margin-top: 1rem"
      (click)="onEditPassword()"
    ></button>
  </div>
</p-dialog>

<p-confirmDialog
  header="Warning"
  icon="pi pi-exclamation-triangle"
  [style]="{ width: '30vw' }"
  [baseZIndex]="10000"
></p-confirmDialog>
